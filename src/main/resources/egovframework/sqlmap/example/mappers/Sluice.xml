<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.sample.service.impl.SluiceMapper">
	<select id="sluiceCount" resultType="int">
		select count(*)
		from sluice
		where 1=1 
	</select>
	<select id="sluiceList" parameterType="Sluice" resultType="Sluice">
	select c.*
		 from	
				(SelECT b.*
			from
			(select 	ROW_NUMBER() OVER (ORDER BY sluice_id) rn , a.*
			from
					(select DISTINCT s.* , ob.type  
					from  observ_data ob 
					right JOIN 	sluice s 
					ON  ob.sluice_id = s.sluice_id 
					 order by name) a 
					) b 
					where 1=1
					<if test='chkmap != null and chkmap.type4 == "0"'>
						and 1=0
					</if>
					<if test='chkmap != null and chkmap.type1 != "0"'>
						or type = '1'
					</if>
					<if test='chkmap != null and chkmap.type2 != "0"'>
						or type = '2'
					</if>
					<if test='chkmap != null and chkmap.type3 != "0"'>
						or type = '3'
					</if>
					) c
					<if test="start != 0 and end != 0">
						where rn BETWEEN #{start} and #{end}
					</if>
	</select>

	<insert id="insertSluice" parameterType="Sluice">
		INSERT INTO 
		sluice (sluice_id,name,mapy,mapx,area,address)
		values (#{sluice_id},#{name},#{mapy},#{mapx},#{area},#{address})
	</insert>
	<select id="sluiceDetail" parameterType="int" resultType="Sluice">
		SELECT * 
		FROM sluice
		WHERE sluice_id = #{sluice_id}
	</select>
	<update id="updateSluice" parameterType="Sluice">
		UPDATE sluice
		SET
		name = #{name},
		mapy = #{mapy},
		mapx = #{mapx},
		area = #{area},
		address = #{address},
		is_deleted = #{is_deleted}
		WHERE sluice_id = #{sluice_id}
	</update>



</mapper>