<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.sample.service.impl.FacilityMapper">
	
	<select id="troubleList" resultType="GojangRp">
		select row_number() over (order by created_at desc) as rn, *
			from gojang_rp
		order by created_at desc;
	</select>
	
	<select id="selectSmallCode" resultType="int">
		select siseol_id from siseol where small_code  = #{small_code}
	</select>
	
	<select id="siseolCodeList" resultType="Siseol">
		select * from siseol order by siseol_id desc	
	</select>
	
	<select id="alarmList" resultType="Alarm" parameterType="int">
		select * from Alarm al
			join siseol si 
		on si.siseol_id = al.siseol_id
			where al.siseol_id = #{siseol_id}
	</select>
	
	<insert id="rpWriteAction" parameterType="GojangRp">
		insert into gojang_rp values
			( #{siseol_id}, nextval('gojang_rp_seq'), #{user_id},
			 CURRENT_DATE, #{title}, #{gojang_date}, #{gojang_cause},
			 #{curr_status}, #{immediate_action}, #{future_plan},#{file_name})
	</insert>
	
	<select id="actionList" resultType="ActionRp">
		select row_number() 
			over (order by created_at desc) 
			as rn, grp.created_at, grp.siseol_id, arp.action_date, arp.user_id
		from gojang_rp grp
			join action_rp arp
		on grp.gojang_id = arp.gojang_id
			order by created_at desc
	</select>
	
</mapper>