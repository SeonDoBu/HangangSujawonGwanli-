<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.sample.service.impl.SiseolMapper">
	<select id="siseolCount" resultType="int">
		select count(*)
		from siseol
	</select>
	
	<select id="siseolList" parameterType="Siseol" resultType="Siseol">
		SELECT b.*
		FROM
		(
			SELECT  ROW_NUMBER() OVER (ORDER BY siseol_id) AS rn, a.*
			FROM
			   (
				SELECT s.*, d.name AS districtName, g.name AS gigwanName, c.content AS siseolName
				FROM SISEOL s
				JOIN COMMONCODE c ON s.small_code = c.small_code AND s.big_code = c.big_code
				JOIN DISTRICT d ON s.district_id = d.district_id
				JOIN GIGWAN g ON s.gigwan_id = g.gigwan_id
				)a
		)b
		WHERE rn BETWEEN #{start} and #{end}
	</select>
	
	<select id="commonList" resultType="Commoncode">
		SELECT *
		FROM Commoncode
		WHERE big_code = 55
		AND NOT (small_code = 999);
	</select>
	
	<select id="districtList" resultType="District">
		select *
		from   District
	</select>
	
	<select id="gigwanList" resultType="Gigwan">
		select *
		from   Gigwan
	</select>
	
	<select id="selectedSiseolCount" parameterType="Siseol" resultType="int">
		select count(*)
		from    siseol
		where   big_code = 55
		<if test="small_code != null">
			  AND small_code = ${small_code}
		</if>
		<if test="district_id != null">
			  AND district_id = ${district_id}
		</if>
		<if test="gigwan_id != null">
			  AND gigwan_id   = ${gigwan_id}
		</if>
		<if test="siseol_id != null">
			  AND siseol_id   = ${siseol_id}
		</if>
	</select>
	
	<select id="selectedSiseolList"  parameterType="Siseol" resultType="Siseol">
		SELECT b.*
		FROM
		(
			SELECT  ROW_NUMBER() OVER (ORDER BY siseol_id) AS rn, a.*
			FROM
			   (
				SELECT s.*, d.name AS districtName, g.name AS gigwanName, c.content AS siseolName
				FROM SISEOL s
				JOIN COMMONCODE c ON s.small_code = c.small_code AND s.big_code = c.big_code
				JOIN DISTRICT d ON s.district_id = d.district_id
				JOIN GIGWAN g ON s.gigwan_id = g.gigwan_id
				WHERE s.big_code = 55
				<if test="small_code != null">
					  AND s.small_code = ${small_code}
				</if>
				<if test="district_id != null">
					  AND s.district_id = ${district_id}
				</if>
				<if test="gigwan_id != null">
					  AND s.gigwan_id   = ${gigwan_id}
				</if>
				<if test="siseol_id != null">
					  AND s.siseol_id   = ${siseol_id}
				</if>
				)a
		)b
		WHERE rn BETWEEN #{start} and #{end}
	</select>
	
</mapper>