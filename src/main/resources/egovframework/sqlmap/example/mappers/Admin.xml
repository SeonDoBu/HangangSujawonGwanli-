<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.sample.service.impl.AdminMapper">
	
	<select id="getUsetAllCount" resultType="int">
		select count(*)
		from users
		<if test="name != null and name != ''">
		where name = #{name}
		</if>	
	</select>
	
	<select id="getUserFindOne" parameterType="String" resultType="Users">
		SELECT
		    a.user_id,
		    a.big_code,
		    a.small_code,
			MAX(a.gigwan_id) AS gigwan_id,
			MAX(a.password) AS password,
			MAX(a.name) AS name,
			MAX(a.email) AS email,
		    MAX(a.tel) AS tel,
			MAX(a.dept) AS dept,
			MAX(a.position) AS dept,
			MAX(a.status) AS status,
		    MAX(b.content) AS content
		FROM
		    users a
		JOIN
		    commoncode b ON a.big_code = b.big_code AND a.small_code = b.small_code
			and a.user_id = #{userId}
		GROUP BY
		    a.user_id, a.big_code, a.small_code;		
	</select>	
	
	<select id="getUserAllList" resultType="Users">
		select
		    ROW_NUMBER() OVER () AS rn,
		    a.user_id,
		    a.big_code,
		    a.small_code,
			MAX(a.gigwan_id) AS gigwan_id,
			MAX(a.password) AS password,
			MAX(a.name) AS name,
			MAX(a.email) AS email,
		    MAX(a.tel) AS tel,
			MAX(a.dept) AS dept,
			MAX(a.position) AS dept,
			MAX(a.status) AS status,
		    MAX(b.content) AS content
		from
		    users a
		join
		    commoncode b on a.big_code = b.big_code and a.small_code = b.small_code
		group by
		    a.user_id, a.big_code, a.small_code;
	</select>
	
	<select id="getNoticeAllCount" resultType="int">
		select count(*)
		from notice
		where 1=1
	</select>
	
	<select id="getNoticeAllList" resultType="Notice" parameterType="Notice">
		select a.*
		from (
		select ROW_NUMBER() OVER (ORDER BY notice_id) rn , *
		from notice
		) a
		where rn BETWEEN #{start} and #{end}
	</select>

	<select id="getNoticeFindOne" parameterType="int"
		resultType="Notice">
		select *
		from notice
		where notice_id = #{noticeId}
	</select>	
	<update id="updateAdNoti" parameterType="Notice">
	UPDATE notice
	SET 
	title = #{title},
	content = #{content},
	created_date = #{created_date},
	file_name = #{file_name}
	where notice_id = #{notice_id}
	and user_id = #{user_id}
	</update>
	<insert id="insertNotice" parameterType="Notice">
	INSERT INTO 
	notice (notice_id , user_id ,title ,content ,created_date, file_name, readcount)
	values (nextval('notice_id_seq') ,#{user_id},#{title},#{content},#{created_date},#{file_name},0)

	</insert>
		<update id="updateUser" parameterType="Users">
		UPDATE users 
		SET 
		name = #{name},
		gigwan_id = #{gigwan_id},
		dept = #{dept},
		tel = #{tel},
		email = #{email},
		status = #{status}	
		where user_id = #{user_id}
	</update>
	
	
</mapper>